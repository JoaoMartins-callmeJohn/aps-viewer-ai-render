<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="https://cdn.autodesk.io/favicon.ico">
    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.css">
    <link rel="stylesheet" href="https://unpkg.com/inspire-tree-dom@4.0.6/dist/inspire-tree-light.min.css">
    <link rel="stylesheet" href="/main.css">
    <title>Autodesk Platform Services: AI pretty pictures stuff</title>
    <script>
      var CURRENT_MODEL = '';
      var CURRENT_IMAGE = '';
      var GLOBAL_VIEWER;
      async function updateImages(signedURLAI, signedURLLMV, isLoadingGif = false){
        const viewerContainer = document.getElementById('preview');
        const imagesContainer  = document.getElementById('image-comparer');
        viewerContainer.style.visibility = 'hidden';
        imagesContainer.style.visibility = 'visible';
        const leftImage = document.getElementById('image-left');
        const rightImage = document.getElementById('image-right');
        leftImage.src = signedURLLMV;
        rightImage.src = signedURLAI;
        if(isLoadingGif){
          const { left: startX, top: startY, right: endX, bottom: endY } = GLOBAL_VIEWER.impl.getCanvasBoundingClientRect();
          let vw = endX-startX;
          let vh = endY-startY;
          leftImage.style += ` height: ${vh}px; width: ${vw}px;`;
        }
        const imagesdiv = document.getElementById('image-comparer');
        imagesdiv.ondblclick = (ev) => {
          let imageDividerRelativePosition = ev.target.position;
          let imageComparerRect = ev.target.getBoundingClientRect();
          let mouseClickRelativePosition = (ev.clientX - imageComparerRect.left)/imageComparerRect.width;
          if(mouseClickRelativePosition*100 > imageDividerRelativePosition){
            viewerContainer.style.visibility = 'visible';
            imagesContainer.style.visibility = 'hidden';
            try{
              let lmvImageSRC = document.getElementById('image-right').src;
              let currentImageName = GLOBAL_VIEWER.getExtension('ImageRenderExtension').viewsNames[lmvImageSRC];
              let viewStateString = localStorage.getItem(currentImageName);
              let viewStateOBJ = JSON.parse(viewStateString);
              GLOBAL_VIEWER.restoreState(viewStateOBJ);
            }
            catch(err){
              console.log('Not able to restore the Viewer state for this image!')
            }
          }
        }
      }

      async function loopImage(element, miliseconds){
        let counter = 0;
        while(counter < miliseconds){
          let opacity = 0;
          element.style.opacity = `${opacity}%`;
          while(opacity<100){
            await new Promise(resolve => setTimeout(resolve, 100));
            opacity += 10;
            element.style.opacity = `${opacity}%`;
          }
          counter += 1000;
        }
      }

      window.onload = () => {
        const drawer = document.querySelector('.drawer-placement-start');
        const openButton = document.getElementById('sidebar-show');
        const closeButton = document.getElementById('hide-sidebar');
        // const closeButton = drawer.querySelector('sl-button[variant="primary"]');

        openButton.addEventListener('click', () => drawer.show());
        closeButton.addEventListener('click', () => drawer.hide());
      }
      
      async function fillPositivePrompt(text){
        const positiveprompt = document.getElementById('positiveprompt');
        positiveprompt.value = text;
      }
    </script>
</head>

<body>
    <div id="header">
        <img class="logo" src="https://cdn.autodesk.io/logo/black/stacked.png" alt="Autodesk Platform Services">
        <span class="title">AI stuff</span>
        <button id="sidebar-show">Show Sidebar</button>
        <button id="login" style="visibility: hidden;">Login</button>
    </div>
    <sl-drawer label="Hubs Browser" placement="start" class="drawer-placement-start">
      <div id="sidebar">
        <input type="text" id="positiveprompt" placeholder="your positive prompt goes here">
        <sl-tooltip content="AEC">
          <sl-icon-button name="house-door" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, architectural photography, photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <sl-tooltip content="MFG">
          <sl-icon-button name="car-front" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, manufacturing photography, photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <sl-tooltip content="SUNSET">
          <sl-icon-button name="sunset" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, (sunset), photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <div id="tree"></div>
        <div class="styles-dragging" id="styles-container" style="visibility:hidden;">
          <sl-carousel pagination id="styles-container">
          </sl-carousel>
        </div>          
      </div>
      <sl-button id="hide-sidebar" slot="footer" variant="primary">Hide</sl-button>
    </sl-drawer>
    <!-- <div id="sidebar">
        <input type="text" id="positiveprompt" placeholder="your positive prompt goes here">
        <sl-tooltip content="AEC">
          <sl-icon-button name="house-door" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, architectural photography, photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <sl-tooltip content="MFG">
          <sl-icon-button name="car-front" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, manufacturing photography, photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <sl-tooltip content="SUNSET">
          <sl-icon-button name="sunset" label="AEC" style="font-size: 1.5rem;" onclick="fillPositivePrompt(`colorful,  sunlight, (sunset), photorealistic (sharp)`)"></sl-icon-button>
        </sl-tooltip>
        <div id="tree"></div>
        <div class="styles-dragging" id="styles-container" style="visibility:hidden;">
          <sl-carousel pagination id="styles-container">
          </sl-carousel>
        </div>          
    </div> -->
    <div id="preview" class="comp viewer-container"></div>
    <sl-image-comparer id="image-comparer" style="visibility:hidden;">
      <img id="image-left"
        slot="before"
        src="https://images.unsplash.com/photo-1517331156700-3c241d2b4d83?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=80&sat=-100&bri=-5"
        alt="Place for the Viewer image."
      />
      <img id="image-right"
        slot="after"
        src="https://images.unsplash.com/photo-1517331156700-3c241d2b4d83?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=80"
        alt="Place for AI rendered image."
      />
    </sl-image-comparer>
    <div class="thumbnails-dragging" id="thumbnails-container">
      <sl-carousel navigation pagination slides-per-page="2" slides-per-move="1" id="itens-container">
        <sl-carousel-item>
          <img
            alt=""
            src="/noimg.png"
          />
        </sl-carousel-item>
      </sl-carousel>
    </div>
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://unpkg.com/inspire-tree@4.3.1/dist/inspire-tree.js"></script>
    <script src="https://unpkg.com/inspire-tree-dom@4.0.6/dist/inspire-tree-dom.min.js"></script>
    <script src="/main.js" type="module"></script>
    <script src="ImageRenderExtension.js"></script>
    <!-- Sweetalert2 to handle notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Shoelace components -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/themes/light.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/shoelace-autoloader.js"></script>


</body>

</html>